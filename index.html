<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI ê¸°ë°˜ ë‚ ì”¨ë³„ ì˜· ì¶”ì²œ (AI ì›¹ ì„œë¹„ìŠ¤)</title>
    <style>
        /* CSS ìŠ¤íƒ€ì¼ */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; color: #333; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background-color: #ffffff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); width: 100%; max-width: 600px; }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        .input-group { margin-bottom: 15px; display: flex; align-items: center; }
        .input-group label { width: 120px; font-weight: 600; color: #2c3e50; }
        .input-group input, .input-group select { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; transition: border-color 0.3s; }
        .input-group input:focus, .input-group select:focus { border-color: #3498db; outline: none; }
        .action-area { display: flex; justify-content: flex-end; margin-top: 25px; }
        button { background-color: #3498db; color: white; padding: 12px 25px; border: none; border-radius: 6px; font-size: 16px; font-weight: 700; cursor: pointer; transition: background-color 0.3s, transform 0.1s; }
        button:hover { background-color: #2980b9; }
        button:active { transform: scale(0.98); }
        #result-area { margin-top: 30px; padding: 20px; border: 1px dashed #3498db; border-radius: 8px; min-height: 100px; background-color: #ecf0f1; white-space: pre-wrap; }
        #result-area h3 { margin-top: 0; color: #2c3e50; }
        /* ë¡œë”© ìŠ¤í”¼ë„ˆë¥¼ ìœ„í•œ CSS ì¶”ê°€ */
        .loading-spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; margin-left: 10px; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ¨ MBTI & ë‚ ì”¨ ì˜· ì¶”ì²œ ì…ë ¥</h1>
        
        <div class="input-group">
            <label for="mbti">MBTI:</label>
            <input type="text" id="mbti" placeholder="ì˜ˆ: INFP, ESTJ" maxlength="4">
        </div>

        <div class="input-group">
            <label for="gender">ì„±ë³„:</label>
            <select id="gender">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                <option value="ì—¬ì„±">ì—¬ì„±</option>
            </select>
        </div>

        <div class="input-group">
            <label for="weather">ë‚ ì”¨:</label>
            <input type="text" id="weather" placeholder="ì˜ˆ: ë§‘ìŒ, ë¹„, ëˆˆ">
        </div>

        <div class="input-group">
            <label for="temp-max">ìµœê³  ê¸°ì˜¨ (â„ƒ):</label>
            <input type="number" id="temp-max" placeholder="ì˜ˆ: 28">
        </div>

        <div class="input-group">
            <label for="temp-min">ìµœì € ê¸°ì˜¨ (â„ƒ):</label>
            <input type="number" id="temp-min" placeholder="ì˜ˆ: 15">
        </div>

        <div class="input-group">
            <label for="style">í‰ì†Œ ìŠ¤íƒ€ì¼:</label>
            <input type="text" id="style" placeholder="ì˜ˆ: ìºì£¼ì–¼, ë¯¸ë‹ˆë©€, ìŠ¤íŠ¸ë¦¿">
        </div>

        <div class="action-area">
            <button onclick="requestOutfitRecommendation()">ì˜· ì¶”ì²œë°›ê¸°</button>
        </div>
        
    </div>

    <div class="container" style="margin-top: 20px;">
        <div id="result-area">
            <h3>ğŸ’Œ ì¶”ì²œ ê²°ê³¼</h3>
            ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
        </div>
    </div>

    <script>
        // **********************************************
        // âœ… ê³ ì • ê·œì¹™ 3)ì— ë”°ë¼ í†µì‹  ê·œê²©ì„ ë§ì¶˜ JavaScript
        // **********************************************

        // âš ï¸ ì£¼ì˜: ë°˜ë“œì‹œ ë³¸ì¸ì˜ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ URLë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.
        // í˜„ì¬ëŠ” ì„œë²„ê°€ ì‹¤í–‰ë  ë¡œì»¬ ê°œë°œ í™˜ê²½ ì£¼ì†Œë¡œ ì„¤ì •í•©ë‹ˆë‹¤. (FastAPI ê¸°ë³¸ ì£¼ì†Œ)
        const BACKEND_BASE_URL = 'https://37f81b4a-14ad-4e36-8378-e8697db2c00f-00-28jqdlsfizo1a.pike.replit.dev:8000'; 
        
        // ê³ ì • ìš”ì²­ ì£¼ì†Œ: BACKEND_BASE_URL + "/ai"
        const REQUEST_URL = BACKEND_BASE_URL + "/ai"; 

        async function requestOutfitRecommendation() {
            const resultArea = document.getElementById('result-area');
            resultArea.innerHTML = '<h3>ğŸ’Œ ì¶”ì²œ ê²°ê³¼</h3>AIê°€ ì½”ë””ë¥¼ ê³ ë¯¼ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”! <span class="loading-spinner"></span>';

            // 1. HTML ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const mbti = document.getElementById('mbti').value.toUpperCase();
            const gender = document.getElementById('gender').value;
            const weather = document.getElementById('weather').value;
            const tempMax = document.getElementById('temp-max').value;
            const tempMin = document.getElementById('temp-min').value;
            const style = document.getElementById('style').value;

            if (!mbti || !gender || !weather || !tempMax || !tempMin || !style) {
                resultArea.innerHTML = "<h3>ğŸ’Œ ì¶”ì²œ ê²°ê³¼</h3>âš ï¸ ëª¨ë“  ì…ë ¥ í•„ë“œë¥¼ ì±„ì›Œì£¼ì„¸ìš”.";
                return;
            }

            // 2. ê³ ì • ê·œì¹™ 1)ì— ë”°ë¼ ëª¨ë“  ì…ë ¥ê°’ì„ 'inputs' ê°ì²´ë¡œ ë§Œë“¤ê¸°
            const inputs = {
                mbti: mbti,
                gender: gender,
                weather: weather,
                temp_max: parseFloat(tempMax),
                temp_min: parseFloat(tempMin),
                style: style
            };

            // 3. ê³ ì • ê·œì¹™ 3)ì— ë”°ë¼ ìš”ì²­ Body êµ¬ì„±
            const requestBody = {
                "inputs": inputs
            };

            try {
                // 4. ê³ ì • ê·œì¹™ 3)ì— ë”°ë¼ POST ìš”ì²­
                const response = await fetch(REQUEST_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody) 
                });

                if (!response.ok) {
                    // ì˜¤ë¥˜ ìƒì„¸ ì •ë³´ í¬í•¨í•˜ì—¬ ì˜¤ë¥˜ ë©”ì‹œì§€ ìƒì„±
                    let errorMessage = `HTTP ì˜¤ë¥˜! ìƒíƒœ ì½”ë“œ: ${response.status}`;
                    try {
                        const errorJson = await response.json();
                        if (errorJson.detail) errorMessage += ` (ìƒì„¸: ${JSON.stringify(errorJson.detail)})`;
                    } catch (e) {
                        errorMessage += " (ì„œë²„ì—ì„œ JSON ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.)";
                    }
                    throw new Error(errorMessage);
                }

                const result = await response.json();
                
                // 5. ê³ ì • ê·œì¹™ 3)ì— ë”°ë¼ ì‘ë‹µ bodyì˜ "answer" ê°’ë§Œ ì‚¬ìš©
                const aiAnswer = result.answer;

                // 6. ê²°ê³¼ í‘œì‹œ ë¡œì§
                // answer ë³€ìˆ˜ì—ëŠ” AIê°€ ë§Œë“¤ì–´ ì¤€ ìµœì¢… ê²°ê³¼ í…ìŠ¤íŠ¸ê°€ ë‹´ê²¨ìˆìŠµë‹ˆë‹¤.
                resultArea.innerHTML = `
                    <h3>âœ… AI ì¶”ì²œ ì½”ë”” ì™„ì„±</h3>
                    <p style="white-space: pre-wrap;">${aiAnswer}</p>
                    <p style="font-size: 0.9em; color: #7f8c8d; margin-top: 15px;">(ê²°ê³¼ëŠ” ë°±ì—”ë“œì—ì„œ ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ë¥¼ í†µí•´ Geminiê°€ ìƒì„±í–ˆìŠµë‹ˆë‹¤.)</p>
                `;

            } catch (error) {
                console.error("í†µì‹  ì˜¤ë¥˜:", error);
                resultArea.innerHTML = `
                    <h3>âŒ í†µì‹  ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p style="color: #e74c3c;">**ì˜¤ë¥˜ ë©”ì‹œì§€:** ${error.message}</p>
                    <p>ë°±ì—”ë“œ ì„œë²„(main.py)ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€, URLì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>
                `;
            }
        }
    </script>
</body>
</html>

