<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI ê¸°ë°˜ ë‚ ì”¨ë³„ ì˜· ì¶”ì²œ</title>
    <style>
        /* CSS ìŠ¤íƒ€ì¼ */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; color: #333; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background-color: #ffffff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); width: 100%; max-width: 600px; }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        .input-group { margin-bottom: 15px; display: flex; align-items: center; }
        .input-group label { width: 120px; font-weight: 600; color: #2c3e50; }
        .input-group input, .input-group select { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; transition: border-color 0.3s; }
        .input-group input:focus, .input-group select:focus { border-color: #3498db; outline: none; }
        .action-area { display: flex; justify-content: flex-end; margin-top: 25px; }
        button { background-color: #3498db; color: white; padding: 12px 25px; border: none; border-radius: 6px; font-size: 16px; font-weight: 700; cursor: pointer; transition: background-color 0.3s, transform 0.1s; }
        button:hover { background-color: #2980b9; }
        button:active { transform: scale(0.98); }
        #result-area { margin-top: 30px; padding: 20px; border: 1px dashed #3498db; border-radius: 8px; min-height: 100px; background-color: #ecf0f1; white-space: pre-wrap; }
        #result-area h3 { margin-top: 0; color: #2c3e50; }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ¨ MBTI & ë‚ ì”¨ ì˜· ì¶”ì²œ ì…ë ¥</h1>
        
        <div class="input-group">
            <label for="mbti">MBTI:</label>
            <input type="text" id="mbti" placeholder="ì˜ˆ: INFP, ESTJ" maxlength="4">
        </div>

        <div class="input-group">
            <label for="gender">ì„±ë³„:</label>
            <select id="gender">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="male">ë‚¨ì„±</option>
                <option value="female">ì—¬ì„±</option>
            </select>
        </div>

        <div class="input-group">
            <label for="weather">ë‚ ì”¨:</label>
            <input type="text" id="weather" placeholder="ì˜ˆ: ë§‘ìŒ, ë¹„, ëˆˆ">
        </div>

        <div class="input-group">
            <label for="temp-max">ìµœê³  ê¸°ì˜¨ (â„ƒ):</label>
            <input type="number" id="temp-max" placeholder="ì˜ˆ: 28">
        </div>

        <div class="input-group">
            <label for="temp-min">ìµœì € ê¸°ì˜¨ (â„ƒ):</label>
            <input type="number" id="temp-min" placeholder="ì˜ˆ: 15">
        </div>

        <div class="input-group">
            <label for="style">í‰ì†Œ ìŠ¤íƒ€ì¼:</label>
            <input type="text" id="style" placeholder="ì˜ˆ: ìºì£¼ì–¼, ë¯¸ë‹ˆë©€, ìŠ¤íŠ¸ë¦¿">
        </div>

        <div class="action-area">
            <button onclick="register()">ì˜· ì¶”ì²œë°›ê¸°</button>
        </div>
        
    </div>

    <div class="container" style="margin-top: 20px;">
        <div id="result-area">
            <h3>ğŸ’Œ ì¶”ì²œ ê²°ê³¼</h3>
            ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
        </div>
    </div>

    <script>
        // âœ… í¬íŠ¸ 8000ì„ ì œê±°í•œ ë°±ì—”ë“œ ì£¼ì†Œë¡œ ë³€ê²½ (Replit ê¶Œì¥ ë°©ì‹)
        const SERVER_URL = 'https://37f81b4a-14ad-4e36-8378-e8697db2c00f-00-28jqdlsfizo1a.pike.replit.dev/recommend_outfit'; 

        async function register() {
            const resultArea = document.getElementById('result-area');
            resultArea.innerHTML = "<h3>ğŸ’Œ ì¶”ì²œ ê²°ê³¼</h3>AIê°€ ì½”ë””ë¥¼ ê³ ë¯¼ ì¤‘ì…ë‹ˆë‹¤... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”! ğŸ¤–";

            const mbti = document.getElementById('mbti').value.toUpperCase();
            const gender = document.getElementById('gender').value;
            const weather = document.getElementById('weather').value;
            const tempMax = document.getElementById('temp-max').value;
            const tempMin = document.getElementById('temp-min').value;
            const style = document.getElementById('style').value;

            if (!mbti || !gender || !weather || !tempMax || !tempMin || !style) {
                resultArea.innerHTML = "<h3>ğŸ’Œ ì¶”ì²œ ê²°ê³¼</h3>âš ï¸ ëª¨ë“  ì…ë ¥ í•„ë“œë¥¼ ì±„ì›Œì£¼ì„¸ìš”.";
                return;
            }

            const requestData = {
                mbti: mbti,
                gender: gender,
                weather: weather,
                temp_max: parseFloat(tempMax),
                temp_min: parseFloat(tempMin),
                style: style
            };

            try {
                const response = await fetch(SERVER_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData) 
                });

                if (!response.ok) {
                    // HTTP 500 (API í• ë‹¹ëŸ‰ ì´ˆê³¼ í¬í•¨) ë“±ì˜ ì˜¤ë¥˜ ì²˜ë¦¬
                    let errorMessage = `HTTP error! status: ${response.status}`;
                    try {
                        const errorJson = await response.json();
                        // 429 RESOURCE_EXHAUSTEDì™€ ê°™ì€ ìƒì„¸ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œ
                        if (errorJson.detail) errorMessage += ` (Detail: ${errorJson.detail})`;
                    } catch (e) {
                        // JSON ì‘ë‹µì´ ì•„ë‹ ê²½ìš° (ì˜ˆ: 502 Bad Gateway)
                    }
                    throw new Error(errorMessage);
                }

                const result = await response.json();
                
                // âœ… ê²°ê³¼ í‘œì‹œ ë¡œì§
                const clothes = result.ai_result.recommendation.join(', ');

                resultArea.innerHTML = `
                    <h3>âœ… ${result.ai_result.outfit_name}</h3>
                    <p><strong>MBTI:</strong> ${result.mbti}</p>
                    <p><strong>ë‚ ì”¨:</strong> ${result.weather} (ìµœê³  ${result.temp_max}Â°C / ìµœì € ${result.temp_min}Â°C)</p>
                    <hr>
                    <p style="font-size: 1.1em; color: #3498db;"><strong>ğŸ‘• ì¶”ì²œ ì½”ë”” ì•„ì´í…œ:</strong></p>
                    <p style="font-weight: bold; font-size: 1.2em;">${clothes}</p>
                    <br>
                    <p><strong>ğŸ’¡ ì¶”ì²œ ì´ìœ :</strong> ${result.ai_result.reasoning}</p>
                    <p><strong>ğŸŒ¡ï¸ ê¸°ì˜¨ íŒ:</strong> ${result.ai_result.temperature_guide}</p>
                `;

            } catch (error) {
                console.error("Fetch Error:", error);
                resultArea.innerHTML = `
                    <h3>âŒ í†µì‹  ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p style="color: #e74c3c;">${error.message}</p>
                    <p>Replit ì›¹ë·° ì£¼ì†Œì™€ ì„œë²„ ì£¼ì†Œ ê°„ì˜ í†µì‹ ì´ ì°¨ë‹¨ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                `;
            }
        }
    </script>
</body>
</html>


